from collections import defaultdict
from os.path import join

from aqt import mw
from aqt.theme import get_windows_dark_mode, get_macos_dark_mode, get_linux_dark_mode
from aqt.webview import AnkiWebView
from aqt.utils import tooltip

from .funcs import _get_state
from .CONSTS import BUTTONS

class ControlsOverlay(AnkiWebView):
    def __init__(self, parent, path):
        super().__init__(parent=parent)
        self.path = path
        self.svg = self.build_svg()
        self.setFixedWidth(800)
        self.setFixedHeight(300)
        self.hide()

    def disappear(self):
        self.hide()

    def appear(self, mod):
        state = _get_state()
        geometry = mw.geometry()
        geometry.setBottom(mw.height()-70)
        geometry.setTop(mw.height() - self.height() - 70)
        geometry.setLeft((mw.width() - self.width()) // 2)
        geometry.setRight(mw.width() - ((mw.width() - self.width()) // 2))
        self.setGeometry(geometry)

        if mod == 'L2 + R2': mod = ''
        
        try:
            theme = get_windows_dark_mode()
        except:
            try:
                theme = get_macos_dark_mode()
            except:
                try:
                    theme = get_linux_dark_mode()
                except:
                    theme = True
                    tooltip("Couldn't detect dark mode")

        theme = 'FFFFFF' if theme else '000000'

        html =  f"""<body height="100%"><div class="text-block" min-height="100%" style="text-align:center">
                    <div position="fixed" bottom="0" width="100%">
                    <svg viewBox="50 0 250 100" version="1.1">
                    <g transform="translate(60)" fill="#{theme}" stroke="#{theme}" font-family="Noto Sans JP" font-size="5px" stroke-width="0.5">
                    {self.svg[state][mod]}
                    </g></svg></div></body>"""
    
        self.stdHtml(html)
        self.show()

    def build_svg(self):
        config = mw.addonManager.getConfig(__name__)
        states = {'deckBrowser','overview','question','answer'}

        bindings = defaultdict(dict)
        for state in states:
            for button, action in config[state].items():
                if action != '': 
                    bindings[state][button] = action

        svg = defaultdict(dict)

        con=f"""
            <path d="m 56.9429,14.4771 c -2.5811,0.9766 -4.2088,2.0087 -4.2095,2.6073 -4e-4,0.2721 -0.6745,1.1965 -1.4607,2.0119 -4.9976,5.0553 -10.6207,17.1843 -14.8452,32.1992 -3.0977,10.8803 -6.6534,29.4332 -6.0955,31.8283 0.1115,0.5987 0.5622,-1.0878 0.9581,-3.8083 1.6395,-10.8275 5.3601,-26.6048 8.6813,-36.723 l 1.8576,-5.7119 -0.0042,3.5372 c 0.0509,4.2992 0.889,6.9667 3.4082,10.7244 2.3515,3.4311 7.2828,6.8651 11.432,7.7949 3.9248,0.9296 9.4217,0.4461 12.7326,-1.1283 l 2.6376,-1.3031 -0.1728,3.7003 c -0.4002,6.3122 2.2862,11.0497 7.9474,13.8315 7.2867,3.6543 16.1516,0.7257 20.1424,-6.5619 1.6868,-3.1544 1.7498,-9.4669 0.0152,-12.6252 C 98.7362,52.6178 95.3191,49.24 93.0771,48.0946 90.723,46.8947 85.9563,46.454 82.8707,47.2668 c -1.627,0.379 -3.0294,0.6496 -3.1414,0.5406 -0.1121,-0.109 0.113,-0.7618 0.5065,-1.4688 1.2926,-2.1753 0.9655,-10.012 -0.489,-13.1155 -1.8459,-4.0835 -5.2628,-7.6246 -9.1862,-9.697 -3.363,-1.7452 -3.8115,-1.8546 -9.1396,-1.8606 -5.3281,-0.0061 -5.7769,0.1023 -9.1441,1.8398 -1.9642,1.0318 -4.3218,2.7705 -5.2765,3.8034 -2.1342,2.4464 -1.2345,0.5428 1.7992,-3.7529 2.5281,-3.5344 4.7741,-5.7086 6.794,-6.4137 4.2644,-1.5733 15.2564,-1.0711 18.1706,0.7824 1.1208,0.7088 2.5788,0.8737 6.3366,0.8235 l 4.8795,-0.1033 -0.0155,12.8429 c -0.0142,11.8089 0.0966,12.9519 0.9932,13.6059 1.569,1.0902 11.5516,1.4824 33.032,1.2891 18.228,-0.1426 19.518,-0.25 20.585,-1.2283 1.179,-0.9782 1.236,-1.3591 1.082,-13.7124 l -0.153,-12.7342 4.879,0.1144 c 3.758,0.0586 5.216,-0.103 6.339,-0.8091 2.919,-1.847 13.912,-2.3243 18.172,-0.7413 2.019,0.7097 4.259,2.889 6.779,6.4291 3.023,4.3026 3.918,6.2083 1.79,3.757 -0.952,-1.0351 -3.306,-2.7791 -5.267,-3.8153 -3.363,-1.7452 -3.812,-1.8546 -9.14,-1.8606 -4.991,-0.0057 -5.889,0.1565 -8.47,1.4597 -1.572,0.8145 -3.648,2.1182 -4.659,2.8789 l -1.74,1.4673 0.003,-2.993 c 0.003,-2.1768 -0.276,-3.1566 -1.005,-3.8105 -2.577,-2.2341 -4.598,-0.495 -4.603,3.9674 -0.004,2.6665 0.22,3.3198 1.173,4.0283 1.288,0.8722 2.635,0.6561 3.758,-0.6487 0.337,-0.4894 0.674,-0.5979 0.673,-0.2714 0,0.2721 -0.506,0.979 -1.067,1.4681 -2.246,1.9566 -3.653,6.2541 -3.659,11.2062 -0.003,2.8298 0.274,5.1157 0.722,5.8781 0.895,1.6336 0.615,1.9054 -1.404,1.1412 -2.298,-0.8189 -8.075,-0.7166 -10.432,0.2059 -2.749,1.0852 -6.455,4.455 -7.916,7.1199 -1.743,3.1543 -1.694,9.467 -0.015,12.6252 3.973,7.2966 12.831,10.2453 20.126,6.6075 5.668,-2.7689 8.366,-7.5003 7.981,-13.8134 l -0.164,-3.7007 2.635,1.3091 c 3.307,1.5819 8.802,2.0779 12.729,1.1572 4.152,-0.9204 9.091,-4.3432 11.451,-7.7689 2.528,-3.7521 3.373,-6.4176 3.434,-10.7167 l 0.004,-3.5372 1.844,5.7161 c 3.297,10.1257 6.98,25.9114 8.593,36.7426 0.389,2.7214 0.836,4.4089 0.949,3.8104 0.564,-2.3938 -2.947,-20.9003 -6.075,-31.9509 -4.02,-14.5888 -9.614,-26.8939 -14.375,-31.7426 -0.84,-0.9261 -1.737,-2.0155 -1.904,-2.5054 -0.615,-1.6333 -4.427,-2.8893 -9.307,-3.1125 -5.776,-0.2786 -9.254,0.5337 -11.444,2.5992 -1.628,1.5763 -1.797,1.6305 -7.125,1.6245 -2.972,-0.0034 -5.72,-0.2786 -6,-0.551 -0.616,-0.5994 -46.0453,-0.4332 -57.4874,0.2069 l -5.9454,0.3197 -1.6806,-1.58 C 72.7573,15.6922 71.0199,14.7107 69.7864,14.3828 66.927,13.6177 59.0751,13.6632 56.9429,14.4771 Z m 11.609,0.4485 c 1.6261,0.3283 3.1958,0.8199 3.476,1.0379 0.2801,0.2724 -0.505,0.2171 -1.6825,-0.0563 -3.4202,-0.7658 -11.6088,-0.6118 -14.1898,0.3104 -1.2905,0.4339 -2.188,0.5417 -2.0194,0.2698 0.5619,-0.8701 5.4428,-2.1162 8.5274,-2.1127 1.6266,-0.0526 4.2622,0.2225 5.8883,0.5509 z m 99.6061,0.3306 c 1.57,0.4916 3.028,1.0918 3.195,1.3641 0.168,0.2723 -0.729,0.1625 -2.018,-0.2744 -2.579,-0.928 -10.767,-1.1005 -14.189,-0.3426 -1.178,0.2708 -1.964,0.3243 -1.683,0.0525 1.684,-1.5218 10.49,-2.0016 14.695,-0.7996 z m -28.832,4.1576 c 0.727,1.0348 0.893,3.1573 0.882,12.4085 -0.011,9.2513 -0.182,11.3734 -0.912,12.4066 l -0.843,1.1962 -25.463,-0.0289 C 90.6127,45.3709 87.472,45.2585 86.6878,44.4957 85.9034,43.7874 85.7936,41.8282 85.806,31.543 c 0.0104,-8.6526 0.183,-12.2441 0.6884,-12.7333 0.5053,-0.4892 7.1235,-0.645 26.3046,-0.6232 l 25.687,0.0291 z m 8.69,2.2955 c 1.008,1.1983 0.554,5.8234 -0.625,6.5295 -1.684,1.0321 -2.972,-0.221 -3.137,-3.1598 -0.165,-2.7756 0.51,-4.1353 2.136,-4.1335 0.561,7e-4 1.29,0.328 1.626,0.7638 z m -78.6336,2.142 c 6.2222,2.728 10.3653,8.6099 10.6938,15.3038 0.2748,4.6804 -1.0212,9.6855 -2.7048,10.5543 -0.6173,0.3258 -2.1335,1.9022 -3.3693,3.479 -2.8087,3.7517 -6.6244,5.3255 -12.6816,5.3731 -7.1229,0.0463 -13.848,-4.1516 -16.9811,-10.5222 -1.2308,-2.559 -1.4537,-3.7565 -1.4487,-7.8924 0.0049,-4.0814 0.2308,-5.3328 1.3552,-7.6171 2.586,-5.0036 7.8066,-8.9159 13.5287,-10.1066 3.0854,-0.6495 8.4127,0.0095 11.6078,1.4281 z M 171.793,23.913 c 3.812,1.6369 7.51,5.1239 9.412,8.7721 1.119,2.2869 1.342,3.5388 1.337,7.6202 -0.005,4.1359 -0.231,5.3328 -1.468,7.8891 -1.968,3.9704 -5.056,6.8511 -9.433,8.8596 -2.974,1.3571 -4.264,1.6278 -7.573,1.624 -6.057,-0.0613 -9.869,-1.6438 -12.669,-5.4018 -1.232,-1.5796 -2.744,-3.1595 -3.361,-3.4867 -1.681,-0.8726 -2.965,-5.8806 -2.679,-10.5603 0.23,-4.6798 1.861,-8.2696 5.286,-11.5853 5.727,-5.4898 13.749,-6.95 21.148,-3.7309 z M 92.2349,48.8555 c 5.2131,2.346 8.1241,6.8116 8.1171,12.5256 -0.061,4.2446 -1.3544,7.073 -4.6668,9.899 -4.4353,3.8043 -10.2691,4.5596 -15.4258,2.0504 -6.2218,-3.0001 -9.4102,-10.0782 -7.2717,-16.0618 2.87,-8.0508 11.6239,-11.9046 19.2472,-8.4132 z m 52.8321,0.0599 c 10.425,5.2361 10.464,19.4939 0.026,24.4887 -5.162,2.4974 -10.994,1.7289 -15.42,-2.0855 -3.306,-2.8335 -4.649,-5.6648 -4.643,-10.0183 0.004,-3.9726 0.848,-6.2028 3.432,-9.0841 2.92,-3.2074 6.736,-4.7268 11.166,-4.4497 2.019,0.1111 4.486,0.6037 5.439,1.1489 z" />
            <path d="m 57.3191,28.0278 c -0.393,0.3805 -0.6751,1.7951 -0.6769,3.2644 -0.0024,2.0135 0.3888,3.1024 1.7886,5.063 0.9518,1.3616 2.0722,2.4512 2.4648,2.4517 0.3365,4e-4 1.5717,-1.0866 2.6949,-2.3914 1.6851,-2.066 2.0225,-2.8275 2.0252,-5.0587 0.0018,-1.4693 -0.2769,-2.9389 -0.669,-3.3203 -0.3922,-0.3814 -2.0744,-0.6554 -3.813,-0.6574 -1.7386,-0.0019 -3.4215,0.2683 -3.8146,0.6487 z m 7.175,3.2189 c -0.0026,2.1768 -0.3402,3.1015 -1.5198,4.6239 -0.8986,0.9785 -1.8531,1.8482 -2.1335,1.8478 -0.3365,-3e-4 -1.1767,-0.9264 -1.9043,-2.1245 -1.1756,-1.8516 -1.5101,-3.4845 -1.226,-6.5861 0.0565,-0.3264 1.5711,-0.5424 3.4219,-0.5403 l 3.3651,0.0038 z" />
            <path d="m 48.3357,36.1805 c -0.393,0.3805 -0.6754,2.0128 -0.6774,3.6997 -0.0021,1.687 0.2764,3.3199 0.6685,3.7013 0.3922,0.3814 1.9061,0.6552 3.4204,0.6569 2.1312,0.0024 3.2534,-0.3772 5.2179,-1.6266 1.3471,-0.9236 2.4701,-2.0107 2.4706,-2.3917 4e-4,-0.3809 -1.1758,-1.6339 -2.6327,-2.7239 -2.1293,-1.635 -3.0823,-1.9626 -5.2136,-1.965 -1.4021,-0.0016 -2.8606,0.2688 -3.2537,0.6493 z m 8.074,1.9138 c 1.0084,0.8719 1.9047,1.7436 1.9043,2.0701 -3e-4,0.2721 -1.011,1.2505 -2.2458,2.0654 -1.7962,1.1952 -2.75,1.5206 -4.6006,1.3553 l -2.4115,-0.166 -0.277,-2.8301 c -0.1664,-1.524 -0.2207,-3.0478 -0.1081,-3.3741 0.1126,-0.3264 1.4589,-0.597 2.9732,-0.5953 2.2434,0.0026 3.1965,0.3302 4.7655,1.4747 z" />
            <path d="m 64.9353,37.451 c -1.5156,1.0866 -2.6946,2.1193 -2.6949,2.3914 -4e-4,0.3265 1.12,1.4161 2.4647,2.506 2.2972,1.8529 2.6897,1.9622 5.7746,1.8024 l 3.2531,-0.1596 0.1724,-3.4282 c 0.2295,-4.2988 -0.3305,-5.0069 -3.7517,-5.0108 -2.0751,-0.0023 -3.1413,0.4318 -5.2182,1.8988 z m 8.4103,2.0774 c 0.1104,1.4695 -0.1158,2.993 -0.5089,3.4279 -1.1234,1.3592 -4.544,0.9199 -7.1217,-0.9332 -1.2888,-0.9266 -2.3533,-1.8529 -2.3531,-2.0706 3e-4,-0.2177 0.9548,-1.0873 2.1336,-1.9023 1.6839,-1.1953 2.5816,-1.4119 4.8809,-1.3005 l 2.804,0.1664 z" />
            <path d="m 58.646,43.9197 c -1.741,1.9571 -2.0224,2.7731 -2.0251,5.0587 -0.0018,1.4693 0.2769,2.9389 0.669,3.3203 0.8963,0.8717 6.7291,0.8784 7.6275,0.0087 0.3931,-0.3805 0.6752,-1.7951 0.677,-3.2644 0.0024,-2.0135 -0.3889,-3.1023 -1.7886,-5.063 -0.9518,-1.3616 -2.0722,-2.4512 -2.4648,-2.4517 -0.3926,-4e-4 -1.6278,1.0866 -2.695,2.3914 z m 4.3741,0.4948 c 1.1199,1.4161 1.4551,2.5049 1.4526,4.6272 l -0.0034,2.8298 -3.3651,-0.0038 c -2.2995,-0.0026 -3.3648,-0.2215 -3.4203,-0.7113 -0.2202,-3.4831 0.0618,-4.7888 1.4661,-6.5831 0.8426,-1.0874 1.741,-1.9571 2.0214,-1.9568 0.2244,3e-4 1.0646,0.8175 1.8487,1.798 z" />
            <path d="m 161.137,24.1186 c -1.628,1.1953 -2.528,3.6976 -2.138,5.6027 0.502,2.1773 3.304,4.3029 5.603,4.3055 2.244,0.0025 5.05,-2.0622 5.558,-4.1296 0.507,-1.9585 -0.555,-4.8439 -2.181,-5.8797 -1.793,-1.1448 -5.27,-1.0944 -6.842,0.1011 z m 5.608,0.224 c 2.915,1.4726 3.528,4.7929 1.337,7.2393 -2.751,3.1532 -8.245,1.1334 -8.24,-2.948 0.06,-3.8093 3.652,-6.0364 6.903,-4.2913 z" />
            <path d="m 162.423,27.1675 c -0.787,1.6317 -1.462,3.2635 -1.462,3.5356 -0.001,0.3809 1.457,0.6002 3.645,0.6027 2.523,0.0029 3.645,-0.2135 3.646,-0.7033 -0.055,-1.034 -2.965,-5.9894 -3.75,-6.208 -0.337,-0.1092 -1.292,1.1413 -2.079,2.773 z m 4.708,3.0528 c -0.001,0.1633 -1.122,0.2708 -2.524,0.2692 -1.403,-0.0015 -2.524,-0.2205 -2.524,-0.4382 0.001,-0.2176 0.563,-1.4686 1.181,-2.6652 l 1.237,-2.2842 1.287,2.3959 c 0.727,1.3613 1.287,2.5592 1.343,2.7225 z" />
            <path d="m 173.911,34.7992 c -0.729,0.3801 -1.684,1.3042 -2.077,2.0112 -3.091,5.4384 4.249,10.8886 8.797,6.5402 4.661,-4.5115 -0.939,-11.6467 -6.72,-8.5514 z m 6.56,1.7489 c 1.513,1.6887 1.566,3.9743 0.105,5.8229 -3.426,4.1864 -10.152,0.4783 -8.295,-4.5262 1.182,-3.3726 5.67,-4.075 8.19,-1.2967 z" />
            <path d="m 173.853,36.7582 c -2.358,2.2829 -0.457,6.5298 3.021,6.5337 1.682,0.0019 4.265,-2.1175 4.266,-3.5324 0.002,-1.0883 -1.061,-3.1031 -1.902,-3.6482 -1.233,-0.8177 -4.262,-0.4402 -5.385,0.6469 z m 5.272,0.3325 c 1.344,1.2532 1.117,3.8106 -0.343,4.7885 -1.796,1.2496 -3.03,1.085 -4.318,-0.5491 -1.456,-1.7975 -1.455,-2.6682 -0.051,-4.0271 1.348,-1.3045 3.535,-1.4108 4.712,-0.2123 z" />
            <path d="m 149.57,35.1525 c -0.505,0.2716 -1.347,1.3046 -1.853,2.2291 -2.53,4.786 3.577,10.2893 8.067,7.1925 4.715,-3.151 2.704,-10.0101 -2.904,-10.0164 -1.234,-0.0014 -2.749,0.269 -3.31,0.5948 z m 5.384,0.6047 c 1.849,0.9273 2.577,2.1253 2.631,4.1389 -0.005,4.0814 -5.841,6.1971 -8.361,3.038 -3.36,-4.1941 1.021,-9.6311 5.73,-7.1769 z" />
            <path d="m 149.733,39.7239 -0.004,2.9931 3.085,0.0035 3.085,0.0035 0.003,-2.9931 0.004,-2.993 -3.085,-0.0035 -3.084,-0.0035 z m 5.048,-0.1575 -0.003,2.34 -2.243,-0.0025 -2.244,-0.0026 0.003,-2.34 0.003,-2.2856 2.243,0.0025 2.244,0.0026 z" />
            <path d="m 162.12,46.3227 c -1.684,1.1409 -2.865,3.8605 -2.475,5.82 0.669,3.4836 6.107,5.4488 8.914,3.2208 3.031,-2.3365 3.259,-5.4382 0.57,-8.0533 -2.185,-2.1249 -4.764,-2.4543 -7.009,-0.9875 z m 6.56,1.4767 c 1.232,1.0898 1.622,3.5935 0.891,5.5518 -0.45,1.0334 -3.088,2.4453 -4.715,2.4435 -0.673,-8e-4 -1.962,-0.7097 -2.858,-1.5814 -2.633,-2.5607 -2.012,-6.0428 1.299,-7.3995 2.076,-0.814 3.646,-0.5401 5.383,0.9856 z" />
            <path d="m 163.069,49.9154 1.232,1.1986 -1.235,1.2503 c -1.348,1.4133 -0.507,1.7408 0.953,0.382 0.842,-0.8154 1.01,-0.8152 2.187,0.329 0.784,0.6539 1.457,0.9268 1.682,0.6005 0.224,-0.2719 -0.224,-0.9254 -0.896,-1.3615 l -1.233,-0.8721 1.348,-1.359 c 0.73,-0.761 1.067,-1.3592 0.73,-1.3596 -0.336,-4e-4 -0.897,0.3799 -1.29,0.8148 -0.394,0.4349 -1.011,0.8152 -1.404,0.8147 -0.392,-4e-4 -1.009,-0.3821 -1.401,-0.8179 -0.392,-0.4358 -0.952,-0.8173 -1.289,-0.8177 -0.336,-4e-4 -0.112,0.5441 0.616,1.1979 z" />
            <path d="m 81.5766,50.6937 c -4.9953,3.0962 -6.515,7.5569 -4.2775,12.4571 2.6853,5.6626 10.1989,7.1405 15.3076,3.0104 C 97.2101,62.4115 96.8268,54.738 91.8394,51.3039 89.3177,49.5597 83.9339,49.227 81.5766,50.6937 Z m 8.4681,0.6082 c 4.4844,1.9642 6.3289,7.1905 4.0243,11.4326 -1.6863,3.1544 -3.6509,4.5126 -7.0725,4.8353 -5.4408,0.4836 -9.6429,-3.1129 -9.6367,-8.2283 0.0083,-6.8568 6.2946,-10.8766 12.6849,-8.0396 z" />
            <path d="m 82.9761,52.872 c -2.1326,1.086 -3.9307,3.9138 -3.9333,6.0905 -0.0026,2.1224 2.0692,4.9001 4.3116,5.7733 5.7178,2.3465 11.5013,-3.2521 8.8718,-8.6425 -1.7342,-3.6481 -5.8268,-5.0132 -9.2501,-3.2213 z m 5.7759,0.714 c 1.6817,0.7094 3.1929,3.2144 3.1906,5.1191 -0.004,3.3195 -2.5306,5.6567 -6.064,5.7071 -3.4212,-0.0039 -5.718,-2.2377 -5.714,-5.5572 0.0616,-4.5168 4.3272,-7.1785 8.5874,-5.269 z" />
            <path d="m 135.699,50.1565 c -6.621,2.4413 -8.314,11.6362 -2.936,16.0503 5.099,4.1416 12.616,2.6808 15.315,-2.9757 2.306,-4.9495 0.405,-10.1215 -4.64,-12.6849 -1.513,-0.7636 -6.112,-0.9865 -7.739,-0.3897 z m 8.355,1.642 c 5.715,4.1423 5.257,12.3047 -0.86,15.1275 -2.581,1.1943 -6.955,0.8629 -9.085,-0.6633 -2.297,-1.5808 -4.143,-5.4466 -3.86,-7.8951 0.849,-6.4205 8.761,-10.1665 13.805,-6.5691 z" />
            <path d="m 136.313,52.9325 c -1.067,0.543 -2.47,1.9019 -3.033,3.0441 -2.866,5.3842 2.903,11.2136 8.739,8.8258 2.188,-0.8683 4.323,-3.6412 4.325,-5.6547 0.007,-5.061 -5.598,-8.6046 -10.031,-6.2152 z m 5.72,0.714 c 2.13,1.0363 3.193,2.779 3.19,5.2822 -0.004,3.3196 -2.306,5.5482 -5.727,5.5443 -4.88,-0.06 -7.622,-4.6343 -5.094,-8.7128 1.518,-2.5016 4.94,-3.4773 7.631,-2.1137 z" />
            <path d="m 77.8554,20.378 c -0.7857,0.4345 -1.0111,1.305 -1.0144,4.0259 -0.0038,3.1563 0.164,3.5919 1.3968,4.4095 1.289,0.8178 1.5134,0.818 2.8043,0.0032 1.2348,-0.7604 1.4037,-1.3044 1.407,-4.0798 0.0051,-4.2447 -1.7875,-5.9337 -4.5937,-4.3588 z m 3.3634,1.4188 c 0.5035,1.0345 0.3863,5.2246 -0.1757,6.1491 -0.4496,0.7614 -2.132,0.705 -2.9723,-0.1122 -0.7283,-0.7083 -0.8918,-4.6266 -0.3292,-6.0953 0.4501,-1.1423 2.8616,-1.0851 3.4772,0.0584 z" />
            <path d="m 106.032,48.8712 c -0.674,0.7611 -0.282,1.4146 0.895,1.4159 0.842,9e-4 1.012,-1.4138 0.227,-1.85 -0.28,-0.1636 -0.785,-9e-4 -1.122,0.4341 z" />
            <path d="m 109.061,48.6025 c -0.45,0.8158 0.166,1.6872 1.175,1.6883 0.505,6e-4 0.786,-0.38 0.675,-0.9243 -0.223,-1.0887 -1.345,-1.5253 -1.85,-0.764 z" />
            <path d="m 111.921,48.9323 c -0.169,0.4896 0.055,0.9796 0.559,1.1978 1.065,0.3822 1.571,-0.107 1.179,-1.1959 -0.447,-1.0344 -1.288,-1.0354 -1.738,-0.0019 z" />
            <path d="m 115.117,48.9359 c -0.393,1.0879 0.111,1.5783 1.177,1.1986 0.505,-0.2171 0.73,-0.7067 0.562,-1.1966 -0.447,-1.0345 -1.289,-1.0355 -1.739,-0.002 z" />
            <path d="m 118.147,48.4496 c -0.787,0.8154 -0.339,1.8498 0.783,1.8511 0.785,9e-4 1.066,-0.2709 0.954,-0.924 -0.167,-0.9798 -1.12,-1.4706 -1.737,-0.9271 z" />
            <path d="m 107.094,51.7022 c -10e-4,0.4897 0.392,0.7623 0.953,0.6541 1.402,-0.2705 1.572,-1.522 0.226,-1.5235 -0.673,-8e-4 -1.178,0.3252 -1.179,0.8694 z" />
            <path d="m 110.179,51.3792 c -0.169,0.2719 -0.169,0.544 0.112,0.5443 0.224,2e-4 -10e-4,0.2721 -0.506,0.598 -1.235,0.6516 -1.349,2.1208 -0.171,2.1222 0.449,5e-4 0.842,-0.4889 0.843,-1.0875 0.001,-0.5986 0.338,-1.088 0.786,-1.0875 0.449,6e-4 0.729,0.4362 0.672,0.9259 0,0.5442 0.392,1.0344 1.008,1.144 0.841,0.1642 1.01,0.0011 0.787,-0.8698 -0.224,-0.7622 0.001,-1.1973 0.786,-1.3596 0.618,-0.1626 0.955,-0.5431 0.731,-0.8699 -0.504,-0.8713 -1.963,-0.7097 -1.964,0.2155 0,0.4353 -0.225,0.816 -0.561,0.8156 -0.281,-3e-4 -0.561,-0.3816 -0.56,-0.8169 0.001,-0.9251 -1.401,-1.09 -1.963,-0.2743 z" />
            <path d="m 116.348,51.3862 c -0.168,0.2719 -0.169,0.544 0.112,0.5443 0.224,2e-4 0,0.2721 -0.506,0.598 -0.561,0.2715 -1.01,0.924 -1.011,1.3593 0,0.4898 0.392,0.7624 1.009,0.6542 0.505,-0.1083 0.898,-0.5976 0.899,-1.1418 -0.056,-0.4898 0.225,-0.9248 0.674,-0.9243 0.449,5e-4 0.785,-0.3801 0.786,-0.8154 10e-4,-0.9251 -1.401,-1.09 -1.963,-0.2743 z" />
            <path d="m 110.562,59.3248 c -1.796,1.1952 -2.415,3.0991 -1.745,5.1134 1.118,2.9943 5.099,3.7607 7.514,1.369 3.818,-3.6418 -1.391,-9.4705 -5.769,-6.4824 z m 5.102,1.203 c 1.961,1.6348 0.386,6.0954 -2.194,6.0924 -1.066,-0.0012 -3.14,-1.0375 -3.7,-1.8544 -0.784,-1.0893 -0.444,-3.4289 0.566,-4.2441 1.853,-1.576 3.367,-1.5743 5.328,0.0061 z" />
            <path d="m 93.8818,78.4614 c -1.908,0.9229 -4.0399,1.4647 -6.7882,1.6248 -3.4775,0.2138 -4.4869,0.0494 -7.1214,-1.1508 -2.5785,-1.1458 -3.3075,-1.2554 -4.3738,-0.7124 -1.1784,0.5428 -3.8189,4.2403 -3.8763,5.3286 -0.0013,1.0884 0.9533,0.1644 1.9652,-1.848 1.6865,-3.2632 2.5282,-3.5888 5.5551,-2.1704 4.7083,2.3453 10.0927,2.1337 15.5922,-0.5266 1.8518,-0.8686 3.6467,-0.9754 17.6114,-0.9595 l 15.536,0.0176 3.7,1.4735 c 4.989,2.0736 10.317,2.1341 14.245,0.1794 3.199,-1.5745 4.04,-1.247 5.718,2.0744 1.007,2.0147 1.96,2.9409 1.961,1.8525 -0.055,-1.0884 -2.686,-4.7919 -3.863,-5.3374 -1.065,-0.5454 -1.795,-0.4374 -4.376,0.7024 -4.096,1.7912 -9.536,1.5674 -14.245,-0.5603 l -3.139,-1.4729 -15.648,0.0367 c -15.5351,0.0912 -15.6473,0.0911 -18.4532,1.4484 z" />"""

        svg_elems = {
            'CROSS':        '<text text-anchor="start"    y="60.85"   x="194"    >',
            'CIRCLE':       '<text text-anchor="start"    y="46.28"   x="190"    >',
            'SQUARE':       '<text text-anchor="start"    y="74.22"   x="197"    >',
            'TRIANGLE':     '<text text-anchor="start"    y="33.90"   x="184"    >',

            'DPAD_UP':      '<text text-anchor="end"      y="32.90"   x="38.83"     >',
            'DPAD_DOWN':    '<text text-anchor="end"      y="57.58"   x="31.03"     >',
            'DPAD_LEFT':    '<text text-anchor="end"      y="44.36"   x="35.49"     >',
            'DPAD_RIGHT':   '<text text-anchor="end"      y="74.01"   x="28.34"     >',

            'L1':           '<text text-anchor="middle"   y="6.39"    x="53.57"     >',
            'R1':           '<text text-anchor="middle"   y="6.60"    x="169.93"    >',
            'SHARE':        '<text text-anchor="middle"   y="12.55"   x="88.11"     >',
            'OPTIONS':      '<text text-anchor="middle"   y="12.55"   x="135.66"    >',
            'PAD':          '<text text-anchor="middle"      y="6.67"    x="115.54"    >',
            
        }

        lines = {
            "TRIANGLE":     '<line y2="31.36" x2="184.03" y1="28.84" x1="171.26" style="fill:#000000;stroke:#000000;stroke-width:0.552456" />',
            "CIRCLE":       '<path d="m   182.96,  41.66    5.85,    2.101"       />',
            "CROSS":        '<path d="m   172.35,  53.01    20.57,   4.832"       />',
            "SQUARE":       """<line y2="47.54" x2="155.02" y1="62.88" x1="161.29"  />
                            <line y2="71.28" x2="196.59" y1="62.67" x1="161.29"  />""",

            "DPAD_UP":      '<path d="M   55.41,   30.94    41.12,   31.154"      />',
            "DPAD_DOWN":    '<line y2="55.10" x2="33.10"  y1="50.91" x1="55.84"   />',
            "DPAD_LEFT":    '<path d="M   46.10,   40.61    36.14,   41.66"       />',
            "DPAD_RIGHT":   """<path d="M   63.64,   63.93    29.64,   71.286"      />
                            <line y2="63.72" x2="63.64"  y1="45.44" x1="72.95"   />""",

            "SHARE":        '<line y2="13.92" x2="88.98"  y1="21.91" x1="81.61"   />',
            "PAD":          '<line y2="8.08"  x2="111.36" y1="25.19" x1="115.24"  />',
            "OPTIONS":      '<line y2="14.13" x2="138.34" y1="21.49" x1="144.84"  />',
            "L1":           '<line y2="7.82"  x2="55.63"  y1="15.82" x1="63.64"   />',
            "R1":           '<line y2="8.67"  x2="173.21" y1="16.44" x1="166.92"  />',
            
            "LEFTSTICK":    '<line y2="74.22" x2="68.84"  y1="66.24" x1="77.71"   />',
            "RIGHTSTICK":   '<line y2="74.01" x2="158.26" y1="65.82" x1="148.30"  />',
        }

        right_stick = 'text-anchor="start"    y="165.21"  x="281.08109"'
        left_stick = 'text-anchor="start"     y="162.89"  x="74.903458"'

        mods = ['', 'L2', 'R2']

        for state in states:
            for mod in mods:
                collect = list()
                collect.append(con)
                for key in svg_elems.keys():
                    modkey = ' + '.join([mod, key]) if mod else key
                    if modkey not in bindings[state]: continue
                    collect.append(f"{svg_elems[key]}{bindings[state][modkey]}</text>")
                    collect.append(lines[key])
                svg[state][mod] = '\n'.join(collect)

        return svg

    def print_svg(self):
        #for state in mw.controller.controlsOverlay.svg.keys():
        for state in self.svg.keys():
            print(state + '\n')
            for mod, s in self.svg[state].items():
                print(mod)
                print('\n')
                print(s)
                print('\n')
                print('\n')